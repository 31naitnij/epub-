# AI EPUB 手术式翻译工具 (Anchor-Based)

这是一个专注于 **EPUB 精准翻译** 的工具。它通过“外科手术式”的 DOM 节点提取与回填处理，在确保 100% 还原书籍排版、图片、CSS 样式的前提下，利用 AI 实现高质量的中文翻译。

## ✨ 核心特性

- **手术式精准回填**：基于 BeautifulSoup 直接操作 XHTML。只翻译文本，不破坏任何 HTML 结构或内联样式。
- **稀有字符锚点策略 (SJSM)**：采用 Unicode 稀有数学符号（`⟬⟭`, `⟦⟧`, `⦗⦘`）作为标记，彻底消除 AI 对原文符号（如普通括号）的歧义，Token 消耗极低。
- **三栏式联动 UI**：
    - **逻辑分组**：直观展示 API 翻译单元。
    - **分块预览**：实时查看当前组内包含的原始段落。
    - **对照编辑**：双分栏实时对照原文标记与译文响应。
- **零依赖部署**：彻底移除对 Pandoc 的依赖。只需 Python 即可运行，不产生中间 Markdown 转换过程。
- **断点续传**：内置缓存系统，翻译过程中断可随时恢复。

## 🚀 快速开始

1. **环境准备**：确保已安装 Python 3.10+。
2. **启动程序**：双击 `run.bat`。
3. **开始翻译**：
    - 选择 EPUB 文件。
    - 点击 **“分块并分组”**。
    - 配置 API 信息（Key, Endpoint 等）。
    - 点击 **“开始翻译”** 或选择特定组进行翻译。
    - 检查无误后，点击 **“导出”**。

## 🧩 核心处理流

1. **解压提取**：解压 EPUB 并在保持目录结构的前提下提取 XHTML 内容。
2. **智能分段**：将 XHTML 拆分为原子段落（Blocks）。
3. **标记聚合**：根据设定的分块大小将多个段落聚合成一个“逻辑组 (Group)”，并插入稀有字符锚点。
4. **AI 响应解析**：利用平衡括号算法精准解析 AI 响应。
5. **DOM 还原**：将翻译后的文本片段原地写回原始 DOM 树。
6. **无损打包**：将修改后的文件原样打包回 EPUB。

## 💡 注意事项

- **Token 优化**：使用稀有字符标记相比 JSON 模式可节省约 15%-30% 的 Token。
- **结构校验**：程序会自动通过锚点编号校验翻译结构的完整性，异常块会标记为错误以待检查。
- **配置保存**：API 配置和提示词规范将自动保存。

---
> [!TIP]
> **专注 EPUB**：本工具目前针对 EPUB 深度垂直开发。若需翻译 DOCX/PDF，请先使用 Calibre 等工具转换为 EPUB。
