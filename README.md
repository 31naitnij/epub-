# 这是完全不懂代码的人，使用google Antigravity生成的翻译工具。
# AI EPUB 翻译工具 AI EPUB Translator

## 🌟 思路

- **避免格式混论**：没有对epub进行html文本提取，而是转化为markdown，为了避免html提取和回填引起混乱，并为了节约tokens，直接将markdown发送给ai处理。但结果会与源文件格式不同。
- **考虑上下文**：按照 -> Assistant(前文译) -> User(当前待译) 的多轮对话结构，保持翻译一致性。现在支持 **1-5 轮可调上下文**，轮数越多翻译越连贯，但会消耗更多 tokens 并可能变慢。
- **没有考虑并发**：因为是从头至尾依次翻译，暂时没有考虑并发。以后应该可以添加，例如每一章独立翻译，但现在每考虑，因为epub结构复杂，并不都是按照章节分的。

## 🚀 快速开始

### 方式一：直接运行 (推荐)
1. 下载项目后，进入 Windows 文件夹。
2. 双击 `dist/AI_EPUB_Translator.exe` 即可直接运行（无需安装 Python）。
3. 右边有打包好的，可以直接用。
 
### 方式二：脚本启动 (环境隔离)
1. 确保安装了 Python 3.10+。
2. 双击运行 `run.bat` (Windows) 或执行 `bash run.sh` (macOS/Linux)。脚本会自动安装依赖并启动。

## 🛠️ 使用步骤

1. **设置路径**：选择要翻译的 EPUB 文件，并指定缓存和输出目录。
2. **配置 API**：
   - 填写 API Key 和 Base URL (如 `https://api.deepseek.com`)。
   - 填写模型名（需要仔细阅读你的ai api文档，获取准确的名称）。
   - 设置提示词（已内置）。
   - **设置上下文轮数**：范围 1-5 轮。建议默认 1 轮，对于长篇连贯性要求高的内容可增加轮数。
3. **处理分块**：点击 **“仅分块处理”**。分块后若认为不合理，可能需要清除缓存，调整块大小，并再次划分。
4. **开始翻译**：
   - 点击 **“全部翻译”** 以自动完成全书
   - 或，选中某个区块，点击 **“翻译当前块”** 进行测试。
5. **导出图书**：全部完成后，点击 **“导出 EPUB”**，程序将执行物理回填并打包。

## 📂 项目结构

- `src/core/`：核心逻辑（转换器、处理器、翻译驱动）。
- `src/ui/`：基于 PySide6 的图形界面。
- `dist/`：发布版可执行文件。
- `build_exe.bat`：Windows 打包脚本。
- `build_macos.sh`：macOS 打包脚本。

## ⚠️ 注意事项

- **缓存管理**：如果您修改了“分块大小”或提示词，建议先点击“清除缓存”再重新开始，以保证数据一致性。
- **分块长度**：建议分块不要太大，即使能带来更好的整体性，但文本越长越容易出错。
- **上下文轮数**：一般情况1即可，如果需要连贯性，可以增加到2-3轮。

## 🛡️ License
[MIT License](LICENSE)
