# AI EPUB/DOCX 翻译工具

> 本项目通过 Google Antigravity 辅助开发。旨在实现原文格式的高保真还原以及上下文连贯的智能翻译。

**核心功能**：
- **格式保留**：通过转换为markdown，带格式翻译，或直接带html代码进行翻译，以保留原文格式。
- **上下文连贯**：支持记忆前 N 段内容，确保长文翻译一定程度的连续性。
- **断点续传**：自动缓存翻译进度，支持随时中断并从上次停止处继续。

**支持格式**：
- **输入**：EPUB, DOCX, Markdown,
- **输出**：EPUB, DOCX, Markdown,
- pdf效果不好，建议使用其他有ocr功能的工具

---

## 🚀 快速开始

**推荐配置**：翻译过程中的格式转换依赖 **Pandoc**，建议前往 [Pandoc 官方页面](https://pandoc.org/installing.html) 安装。

> [!TIP]
> 如果您希望最大限度保留原文样式，可以在输出设置中选择“EPUB 直接翻译”。该模式会将内置 HTML 代码与文本一同发送给 AI，适用于结构极其复杂的电子书，但会消耗更多 Token。

### 方法 1：下载 Release (推荐)
1.  在 GitHub Releases 页面下载最新 `.zip` 包。
2.  解压后直接运行 `AI_EPUB_Translator.exe`。

### 方法 2：源码运行
此方法会自动创建虚拟环境 (`.venv`)，不污染系统。
1.  安装 Python 3.10+。
2.  双击 `run.bat` (Windows) 或运行 `bash run.sh` (macOS/Linux)。

### 方法 3：自行构建
如果要生成自己的 exe 文件：
1.  运行 `build_exe.bat` (Windows) 或 `bash build_macos.sh`。
2.  成品位于 `dist/` 目录。

---

## 📖 使用方法

请按照界面布局顺序操作：

1.  **设置路径**
    *   **选择文件**：载入待翻译的文档。
    *   **缓存/输出**：首次运行建议手动指定。软件会通过配置文件自动记录后续路径。
    *   **输出格式**：选择目标格式。若开启格式转换（需 Pandoc），可显著节省 Token 但可能微调排版；若不转换则能完美保留格式，建议用于包含复杂图表、公式的文档。

2.  **API 配置** (右上角)
    *   填写 `API Key`, `API URL`, `模型名称` (例如 `gpt-4o`, `deepseek-chat`)。
    *   *注：请参考所选 AI 服务商的文档。通常 URL 填至 `/v1` 即可，软件会自动补全 `/chat/completions`。*

3.  **预处理** (底部)
    *   点击 **“仅分块处理”**。
    *   左侧列表会出现该书的所有段落。
    *   *注：如果有旧缓存，选文件时会自动加载，无需重新点此按钮。*

4.  **开始翻译**
    *   **方式 A (测试)**：在左侧列表中按 Ctrl/Shift 选中几行 -> 点击 **“翻译选中块”**。
    *   **方式 B (全书)**：直接点击 **“全部翻译”**。

5.  **导出** (底部)
    *   在 **“输出格式”** 下拉框选择想要的格式 (如 DOCX)。
    *   点击 **“导出”**。

---

## 🧩 运行原理

1.  **解压/转换**：将 EPUB/DOCX 转为 Markdown 中间格式。
2.  **分块**：按字数切分为小块，ID化管理。
3.  **AI 翻译**：调用大模型，携带前 N 个块的译文作为背景知识 (`System Prompts`)。
4.  **重组/回填**：
    *   **EPUB模式**：将译文塞回原 EPUB 的 HTML 骨架中。
    *   **Pandoc模式**：合并译文，调用 Pandoc 转为目标格式。

---

## ⚠️ 注意事项

*   **API 配置**：API URL 通常只需填写到域名或 `/v1`。软件后台会自动拼接完整的请求路径。
*   **分块建议**：推荐设置为 `1000 - 2000` 字符。分块过小可能导致语境丢失，过大则容易触发 AI 遗忘或响应超时。
*   **打印支持**：PDF/DOCX 输出默认采用标准 **A4** 纸张规格，方便直接打印。
*   **清除缓存**：若修改了**切分大小**或**提示词（Prompt）**，**必须点击“清除缓存”**以重新分块，否则程序将继续沿用旧有的分块数据。
