# AI EPUB/DOCX 翻译工具

> 由新手借助 Google Antigravity 开发。

一款专注于保留文档格式、支持多轮上下文理解的本地化 AI 翻译工具。

**核心功能**：
- **格式完美保留**：EPUB 原样输出（保留样式/图片），DOCX/PDF 格式不乱。
- **上下文记忆**：支持记忆前 N 段内容，确保小说/长文翻译连贯。
- **断点续传**：自动缓存翻译进度，随时关闭，随时继续。
- **批量管理**：支持列表预览、多选翻译。

**支持格式**：
- **输入**：EPUB, DOCX, Markdown, PDF (需Pandoc), TXT
- **输出**：EPUB, DOCX (A4), Markdown

---

## 🚀 快速开始

**前提条件**：所有高级格式转换依赖 **Pandoc**。请务必安装 [Pandoc](https://pandoc.org/installing.html)。

### 方法 1：下载 Release (推荐)
1.  在 GitHub Releases 页面下载最新 `.zip` 包。
2.  解压后直接运行 `AI_EPUB_Translator.exe`。

### 方法 2：源码运行
此方法会自动创建虚拟环境 (`.venv`)，不污染系统。
1.  安装 Python 3.10+。
2.  双击 `run.bat` (Windows) 或运行 `bash run.sh` (macOS/Linux)。

### 方法 3：自行构建
如果要生成自己的 exe 文件：
1.  运行 `build_exe.bat` (Windows) 或 `bash build_macos.sh`。
2.  成品位于 `dist/` 目录。

---

## 📖 使用方法

请按照界面布局顺序操作：

1.  **设置路径**
    *   **选择文件**：载入要翻译的书。
    *   **缓存/输出**：第一次运行可手动指定，软件通过Config会自动记忆。

2.  **API 配置** (右上角)
    *   填写 `API Key`, `API URL`, `模型名称` (如 `gpt-4o`, `deepseek-chat`)。
    *   *提示：如果不确定，请咨询您的 API 服务商。*

3.  **预处理** (底部)
    *   点击 **“仅分块处理”**。
    *   左侧列表会出现该书的所有段落。
    *   *注：如果有旧缓存，选文件时会自动加载，无需重新点此按钮。*

4.  **开始翻译**
    *   **方式 A (测试)**：在左侧列表中按 Ctrl/Shift 选中几行 -> 点击 **“翻译选中块”**。
    *   **方式 B (全书)**：直接点击 **“全部翻译”**。

5.  **导出** (底部)
    *   在 **“输出格式”** 下拉框选择想要的格式 (如 DOCX)。
    *   点击 **“导出”**。

---

## 🧩 运行原理

1.  **解压/转换**：将 EPUB/DOCX 转为 Markdown 中间格式。
2.  **分块**：按字数切分为小块，ID化管理。
3.  **AI 翻译**：调用大模型，携带前 N 个块的译文作为背景知识 (`System Prompts`)。
4.  **重组/回填**：
    *   **EPUB模式**：将译文塞回原 EPUB 的 HTML 骨架中。
    *   **Pandoc模式**：合并译文，调用 Pandoc 转为目标格式。

---

## ⚠️ 注意事项

*   **API 相关**：请确保 URL 末尾不需要加 `/v1/chat/completions`，通常只需填到域名或 `/v1` (视服务商而定，软件会自动拼接)。
*   **分块建议**：推荐 `1000-2000` 字符。太小会导致上下文割裂，太大会导致 AI 遗忘或超时。
*   **输出**：PDF/DOCX 输出默认强制使用 **A4** 纸张大小，适合打印。
*   **清除缓存**：如果你修改了分块大小或提示词，**必须**点击“清除缓存”重新分块，否则程序会读取旧的切片数据。
